{% load i18n %}
<h2 class="navigation-title">{% trans "Categories" %}</h2>
<div class="navigation-body manage-categories-portlet">
    <ol class="manage-categories-tree sortable">
        {% for category in categories %}
            <li id="category_{{ category.id }}">
                <div>
                    <a class="selectable {% if category.is_current %}selected{% endif %}"
                       href="{% url lfs_manage_category category.id %}">
                        {{ category.name }}
                    </a>
                 </div>
                 {{ category.children }}

            </li>
        {% endfor %}
    </ol>
</div>


<script>

	$(document).ready(function(){

		$('ol.sortable').nestedSortable({
			disableNesting: 'no-nest',
			forcePlaceholderSize: true,
			handle: 'div',
			helper:	'clone',
			items: 'li',
			maxLevels: 3,
			opacity: .6,
			placeholder: 'placeholder',
			revert: 250,
			tabSize: 25,
			tolerance: 'pointer',
			toleranceElement: '> div',
            stop: function(event,ui){
                // send new position here
                console.log("Position changeid");
                serialized = $('ol.sortable').nestedSortable('serialize');
                console.log('serialized is ' + serialized);
                deArray = $('ol.sortable').nestedSortable('toArray');
                console.log('toArray is ' + deArray);
                $.ajax({

                  url: "{% url lfs-sort-categories %}",
                  context: document.body,
                  type: "POST",
                  data: {"categories": serialized},
                  success: function(data) {
                    console.log("Server response:  " + data );
                  },
                  error: function(data) {
                    alert("an error occurred");
                  }

               });
            }
		});

    });

</script>